<!doctype html>
<html lang=en-US>

<!-- Mirrored from codemirror.net/examples/change/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jul 2024 17:27:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta charset=utf8>
<meta name="viewport" content="width=device-width, initial-scale=1"><title>CodeMirror Document Change Example</title>
<link rel=stylesheet href=../../style/site.css>
<link rel=icon href=../../style/logo.svg>

<header>
  <nav>
    <a class=logo href="../../index.html">CodeMirror</a>
    <div class=navlinks>
      <a href="../index.html" class=active>Examples</a>
      <a href="../../docs/index.html" >Documentation</a>
      <a href="../../try/index.html" >Try</a>
      <a href="https://discuss.codemirror.net/">Discuss</a>
      <a href="https://github.com/codemirror/dev/">GitHub</a>
      <a href="../../5/index.html">Version 5</a>
    </div>
  </nav>
</header><article><h1 id="example%3A-document-changes" tabindex="-1">Example: Document Changes</h1>
<p>Initiating an editor state change from a program is done by
<a href="../../docs/ref/index.html#view.EditorView.dispatch">dispatching</a> a
<a href="../../docs/ref/index.html#state.Transaction">transaction</a>.</p>
<pre><code class="language-javascript"><span class="tok-comment">// Insert text at the start of the document</span>
<span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">dispatch</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">changes</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">from</span><span class="tok-punctuation">:</span> <span class="tok-number">0</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">insert</span><span class="tok-punctuation">:</span> <span class="tok-string">&quot;#!/usr/bin/env node</span><span class="tok-string2">\n</span><span class="tok-string">&quot;</span><span class="tok-punctuation">}</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p>Changes (replacements) are <a href="../../docs/ref/index.html#state.ChangeSpec">described</a> with
<code>{from, to, insert}</code> objects. For insertions, <code>to</code> can be omitted, and
for deletions, <code>insert</code> can be omitted.</p>
<p>When dispatching a transaction, you can also pass an array of changes.
The <code>from</code>/<code>to</code> in each of these changes refer to positions in the
start document, not to the document created by previously listed
changes.</p>
<p>For example, to replace all tabs in a document with two spaces, you
could do something like this:</p>
<pre><code class="language-javascript"><span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">text</span> <span class="tok-operator">=</span> <span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">doc</span><span class="tok-operator">.</span><span class="tok-propertyName">toString</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span><span class="tok-punctuation">,</span> <span class="tok-variableName tok-definition">pos</span> <span class="tok-operator">=</span> <span class="tok-number">0</span>
<span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">changes</span> <span class="tok-operator">=</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">]</span>
<span class="tok-keyword">for</span> <span class="tok-punctuation">(</span><span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">next</span><span class="tok-punctuation">;</span> <span class="tok-punctuation">(</span><span class="tok-variableName">next</span> <span class="tok-operator">=</span> <span class="tok-variableName">text</span><span class="tok-operator">.</span><span class="tok-propertyName">indexOf</span><span class="tok-punctuation">(</span><span class="tok-string">&quot;</span><span class="tok-string2">\t</span><span class="tok-string">&quot;</span><span class="tok-punctuation">,</span> <span class="tok-variableName">pos</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span> <span class="tok-operator">&gt;</span> <span class="tok-operator">-</span><span class="tok-number">1</span><span class="tok-punctuation">;</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
  <span class="tok-variableName">changes</span><span class="tok-operator">.</span><span class="tok-propertyName">push</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">from</span><span class="tok-punctuation">:</span> <span class="tok-variableName">next</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">to</span><span class="tok-punctuation">:</span> <span class="tok-variableName">next</span> <span class="tok-operator">+</span> <span class="tok-number">1</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">insert</span><span class="tok-punctuation">:</span> <span class="tok-string">&quot;  &quot;</span><span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
  <span class="tok-variableName">pos</span> <span class="tok-operator">=</span> <span class="tok-variableName">next</span> <span class="tok-operator">+</span> <span class="tok-number">1</span>
<span class="tok-punctuation">}</span>
<span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">dispatch</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">changes</span><span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p>When acting on the selection, you'll often want to create your
<a href="../../docs/ref/index.html#state.TransactionSpec">transaction spec</a> using the
<a href="../../docs/ref/index.html#state.EditorState.replaceSelection"><code>replaceSelection</code></a> method.
This replaces each selection range with a given string, <em>and</em> moves
the selection ranges to the end of that string (by default, they'd
stay in front of it):</p>
<pre><code class="language-javascript"><span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">dispatch</span><span class="tok-punctuation">(</span><span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">replaceSelection</span><span class="tok-punctuation">(</span><span class="tok-string">&quot;â˜…&quot;</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span>
</code></pre>
<p>To do something more complicated with each <a href="../../docs/ref/index.html#state.EditorSelection.ranges">selection
range</a>, without manually dealing with
the potentially complicated interactions between those ranges and the
changes created for them, you can use the
<a href="../../docs/ref/index.html#state.EditorState.changeByRange"><code>changeByRange</code></a> helper. This
would wrap all ranges in underscores, for example:</p>
<pre><code class="language-javascript"><span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">dispatch</span><span class="tok-punctuation">(</span><span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">changeByRange</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">range</span> <span class="tok-punctuation">=&gt;</span> <span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">changes</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">from</span><span class="tok-punctuation">:</span> <span class="tok-variableName">range</span><span class="tok-operator">.</span><span class="tok-propertyName">from</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">insert</span><span class="tok-punctuation">:</span> <span class="tok-string">&quot;_&quot;</span><span class="tok-punctuation">}</span><span class="tok-punctuation">,</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">from</span><span class="tok-punctuation">:</span> <span class="tok-variableName">range</span><span class="tok-operator">.</span><span class="tok-propertyName">to</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">insert</span><span class="tok-punctuation">:</span> <span class="tok-string">&quot;_&quot;</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span><span class="tok-punctuation">,</span>
  <span class="tok-propertyName tok-definition">range</span><span class="tok-punctuation">:</span> <span class="tok-variableName">EditorSelection</span><span class="tok-operator">.</span><span class="tok-propertyName">range</span><span class="tok-punctuation">(</span><span class="tok-variableName">range</span><span class="tok-operator">.</span><span class="tok-propertyName">from</span><span class="tok-punctuation">,</span> <span class="tok-variableName">range</span><span class="tok-operator">.</span><span class="tok-propertyName">to</span> <span class="tok-operator">+</span> <span class="tok-number">2</span><span class="tok-punctuation">)</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span>
</code></pre>
<p>The method takes a callback, which is called for each current
selection range. It should return an object enumerating the changes
for that range, plus the range's new position (taking into account the
changes made for that range, but not those made for other ranges).</p>
</article><footer>
  <nav>
    <div class=navlinks>
      <a href="http://contributor-covenant.org/version/1/1/0/">Code of Conduct</a>
      <a href="https://github.com/codemirror/dev/issues">Report an Issue</a>
    </div>
  </nav>
</footer>


<!-- Mirrored from codemirror.net/examples/change/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jul 2024 17:27:17 GMT -->
</html>